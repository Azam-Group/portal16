'use strict';

/*
HEADLINE with batch infos
MAP LOCATION
SUMMARY + FREE?
FREE? COMPOSED? e.g. last seen in area OR estimated temperature OR species traits OR suspicious data
MEDIA
SIMILAR
DETAILS
GBIF SPECIFIC INFO
*/

var angular = require('angular');

angular
    .module('portal')
    .controller('occurrenceKeyCtrl', occurrenceKeyCtrl);

/** @ngInject */
function occurrenceKeyCtrl(Occurrence, leafletData, SimilarOccurrence, OccurrenceVerbatim, moment, $http, $firebaseArray) {
    var vm = this;
    vm.comments;
    vm.detailsStates = {
        INTERPRETED: 0,
        COMPARE: 1,
        DIFF: 2
    };
    vm.detailsState = vm.detailsStates.INTERPRETED;
    vm.compare = true;
    vm.similarities = {
        similarRecords: []
    };


    vm.barData = {
        // labels: [1, 2, 3, 4, 5, 6, 7, 8],
        series: [
            [1, 2, 3, 1, -2, 0, 1, 0],
        ]
    };
    var response = {"shape":[{"lat":59.336170,"lon":6.264790},{"lat":59.335720,"lon":6.264790},{"lat":59.335270,"lon":6.264790},{"lat":59.334820,"lon":6.264790},{"lat":59.334370,"lon":6.264790},{"lat":59.333920,"lon":6.264790},{"lat":59.333469,"lon":6.264790},{"lat":59.333019,"lon":6.264790},{"lat":59.332569,"lon":6.264790},{"lat":59.332119,"lon":6.264790},{"lat":59.331669,"lon":6.264790},{"lat":59.331219,"lon":6.264790},{"lat":59.330769,"lon":6.264790},{"lat":59.330318,"lon":6.264790},{"lat":59.329868,"lon":6.264790},{"lat":59.329418,"lon":6.264790},{"lat":59.328968,"lon":6.264790},{"lat":59.328518,"lon":6.264790},{"lat":59.328068,"lon":6.264790},{"lat":59.327618,"lon":6.264790},{"lat":59.327168,"lon":6.264790},{"lat":59.326717,"lon":6.264790},{"lat":59.326267,"lon":6.264790},{"lat":59.325817,"lon":6.264790},{"lat":59.325367,"lon":6.264790},{"lat":59.324917,"lon":6.264790},{"lat":59.324467,"lon":6.264790},{"lat":59.324017,"lon":6.264790},{"lat":59.323566,"lon":6.264790},{"lat":59.323116,"lon":6.264790},{"lat":59.322666,"lon":6.264790},{"lat":59.322216,"lon":6.264790},{"lat":59.321766,"lon":6.264790},{"lat":59.321316,"lon":6.264790},{"lat":59.320866,"lon":6.264790},{"lat":59.320415,"lon":6.264790},{"lat":59.319965,"lon":6.264790},{"lat":59.319515,"lon":6.264790},{"lat":59.319065,"lon":6.264790},{"lat":59.318615,"lon":6.264790},{"lat":59.318165,"lon":6.264790},{"lat":59.317715,"lon":6.264790},{"lat":59.317265,"lon":6.264790},{"lat":59.316814,"lon":6.264790},{"lat":59.316364,"lon":6.264790},{"lat":59.315914,"lon":6.264790},{"lat":59.315464,"lon":6.264790},{"lat":59.315014,"lon":6.264790},{"lat":59.314564,"lon":6.264790},{"lat":59.314114,"lon":6.264790},{"lat":59.313663,"lon":6.264790},{"lat":59.313213,"lon":6.264790},{"lat":59.312763,"lon":6.264790},{"lat":59.312313,"lon":6.264790},{"lat":59.311863,"lon":6.264790},{"lat":59.311413,"lon":6.264790},{"lat":59.310963,"lon":6.264790},{"lat":59.310513,"lon":6.264790},{"lat":59.310062,"lon":6.264790},{"lat":59.309612,"lon":6.264790},{"lat":59.309162,"lon":6.264790},{"lat":59.308712,"lon":6.264790},{"lat":59.308262,"lon":6.264790},{"lat":59.307812,"lon":6.264790},{"lat":59.307362,"lon":6.264790},{"lat":59.306911,"lon":6.264790},{"lat":59.306461,"lon":6.264790},{"lat":59.306011,"lon":6.264790},{"lat":59.305561,"lon":6.264790},{"lat":59.305111,"lon":6.264790},{"lat":59.304661,"lon":6.264790},{"lat":59.304211,"lon":6.264790},{"lat":59.303761,"lon":6.264790},{"lat":59.303310,"lon":6.264790},{"lat":59.302860,"lon":6.264790},{"lat":59.302410,"lon":6.264790},{"lat":59.301960,"lon":6.264790},{"lat":59.301510,"lon":6.264790},{"lat":59.301060,"lon":6.264790},{"lat":59.300610,"lon":6.264790},{"lat":59.300159,"lon":6.264790},{"lat":59.299709,"lon":6.264790},{"lat":59.299259,"lon":6.264790},{"lat":59.298809,"lon":6.264790},{"lat":59.298359,"lon":6.264790},{"lat":59.297909,"lon":6.264790},{"lat":59.297459,"lon":6.264790},{"lat":59.297009,"lon":6.264790},{"lat":59.296558,"lon":6.264790},{"lat":59.296108,"lon":6.264790},{"lat":59.295658,"lon":6.264790},{"lat":59.295208,"lon":6.264790},{"lat":59.294758,"lon":6.264790},{"lat":59.294308,"lon":6.264790},{"lat":59.293858,"lon":6.264790},{"lat":59.293407,"lon":6.264790},{"lat":59.292957,"lon":6.264790},{"lat":59.292507,"lon":6.264790},{"lat":59.292057,"lon":6.264790},{"lat":59.291607,"lon":6.264790},{"lat":59.291157,"lon":6.264790},{"lat":59.290707,"lon":6.264790},{"lat":59.290257,"lon":6.264790},{"lat":59.289806,"lon":6.264790},{"lat":59.289356,"lon":6.264790},{"lat":59.288906,"lon":6.264790},{"lat":59.288456,"lon":6.264790},{"lat":59.288006,"lon":6.264790},{"lat":59.287556,"lon":6.264790},{"lat":59.287106,"lon":6.264790},{"lat":59.286659,"lon":6.264790},{"lat":59.286209,"lon":6.264790},{"lat":59.285763,"lon":6.264790},{"lat":59.285313,"lon":6.264790},{"lat":59.284866,"lon":6.264790},{"lat":59.284416,"lon":6.264790},{"lat":59.283970,"lon":6.264790},{"lat":59.283520,"lon":6.264790},{"lat":59.283073,"lon":6.264790},{"lat":59.282623,"lon":6.264790},{"lat":59.282177,"lon":6.264790},{"lat":59.281727,"lon":6.264790},{"lat":59.281281,"lon":6.264790},{"lat":59.280830,"lon":6.264790},{"lat":59.280384,"lon":6.264790},{"lat":59.279934,"lon":6.264790},{"lat":59.279488,"lon":6.264790},{"lat":59.279037,"lon":6.264790},{"lat":59.278591,"lon":6.264790},{"lat":59.278141,"lon":6.264790},{"lat":59.277695,"lon":6.264790},{"lat":59.277245,"lon":6.264790},{"lat":59.276798,"lon":6.264790},{"lat":59.276348,"lon":6.264790},{"lat":59.275902,"lon":6.264790},{"lat":59.275452,"lon":6.264790},{"lat":59.275005,"lon":6.264790},{"lat":59.274555,"lon":6.264790},{"lat":59.274109,"lon":6.264790},{"lat":59.273659,"lon":6.264790},{"lat":59.273212,"lon":6.264790},{"lat":59.272762,"lon":6.264790},{"lat":59.272316,"lon":6.264790},{"lat":59.271866,"lon":6.264790},{"lat":59.271420,"lon":6.264790},{"lat":59.270969,"lon":6.264790},{"lat":59.270523,"lon":6.264790},{"lat":59.270073,"lon":6.264790},{"lat":59.269627,"lon":6.264790},{"lat":59.269176,"lon":6.264790},{"lat":59.268730,"lon":6.264790},{"lat":59.268280,"lon":6.264790},{"lat":59.267834,"lon":6.264790},{"lat":59.267384,"lon":6.264790},{"lat":59.266937,"lon":6.264790},{"lat":59.266487,"lon":6.264790},{"lat":59.266041,"lon":6.264790},{"lat":59.265591,"lon":6.264790},{"lat":59.265144,"lon":6.264790},{"lat":59.264694,"lon":6.264790},{"lat":59.264248,"lon":6.264790},{"lat":59.263798,"lon":6.264790},{"lat":59.263351,"lon":6.264790},{"lat":59.262901,"lon":6.264790},{"lat":59.262455,"lon":6.264790},{"lat":59.262005,"lon":6.264790},{"lat":59.261559,"lon":6.264790},{"lat":59.261108,"lon":6.264790},{"lat":59.260662,"lon":6.264790},{"lat":59.260212,"lon":6.264790},{"lat":59.259766,"lon":6.264790},{"lat":59.259315,"lon":6.264790},{"lat":59.258869,"lon":6.264790},{"lat":59.258419,"lon":6.264790},{"lat":59.257973,"lon":6.264790},{"lat":59.257523,"lon":6.264790},{"lat":59.257076,"lon":6.264790},{"lat":59.256626,"lon":6.264790},{"lat":59.256180,"lon":6.264790},{"lat":59.255730,"lon":6.264790},{"lat":59.255283,"lon":6.264790},{"lat":59.254833,"lon":6.264790},{"lat":59.254387,"lon":6.264790},{"lat":59.253937,"lon":6.264790},{"lat":59.253490,"lon":6.264790},{"lat":59.253040,"lon":6.264790},{"lat":59.252594,"lon":6.264790},{"lat":59.252144,"lon":6.264790},{"lat":59.251698,"lon":6.264790},{"lat":59.251247,"lon":6.264790},{"lat":59.250801,"lon":6.264790},{"lat":59.250351,"lon":6.264790},{"lat":59.249905,"lon":6.264790},{"lat":59.249454,"lon":6.264790},{"lat":59.249008,"lon":6.264790},{"lat":59.248558,"lon":6.264790},{"lat":59.248112,"lon":6.264790},{"lat":59.247662,"lon":6.264790},{"lat":59.247215,"lon":6.264790},{"lat":59.246765,"lon":6.264790},{"lat":59.246319,"lon":6.264790},{"lat":59.245869,"lon":6.264790},{"lat":59.245422,"lon":6.264790},{"lat":59.244972,"lon":6.264790},{"lat":59.244526,"lon":6.264790},{"lat":59.244076,"lon":6.264790},{"lat":59.243629,"lon":6.264790},{"lat":59.243179,"lon":6.264790},{"lat":59.242733,"lon":6.264790},{"lat":59.242283,"lon":6.264790},{"lat":59.241837,"lon":6.264790},{"lat":59.241386,"lon":6.264790},{"lat":59.240940,"lon":6.264790},{"lat":59.240490,"lon":6.264790},{"lat":59.240044,"lon":6.264790},{"lat":59.239594,"lon":6.264790},{"lat":59.239147,"lon":6.264790},{"lat":59.238697,"lon":6.264790},{"lat":59.238251,"lon":6.264790},{"lat":59.237801,"lon":6.264790},{"lat":59.237354,"lon":6.264790},{"lat":59.236904,"lon":6.264790},{"lat":59.236458,"lon":6.264790},{"lat":59.236172,"lon":6.264790}],"range_height":[[0,329],[50,335],[100,343],[150,354],[200,368],[251,367],[301,352],[351,339],[401,331],[451,334],[501,345],[551,329],[601,290],[651,256],[702,226],[752,204],[802,191],[852,181],[902,170],[952,170],[1002,167],[1052,159],[1102,144],[1153,121],[1203,93],[1253,65],[1303,46],[1353,30],[1403,16],[1453,19],[1503,10],[1553,-3],[1603,-14],[1654,-26],[1704,-36],[1754,-46],[1804,-55],[1854,-64],[1904,-72],[1954,-79],[2004,-85],[2054,-91],[2105,-96],[2155,-99],[2205,-102],[2255,-104],[2305,-105],[2355,-106],[2405,-106],[2455,-105],[2505,-103],[2556,-102],[2606,-100],[2656,-97],[2706,-95],[2756,-93],[2806,-90],[2856,-87],[2906,-83],[2956,-80],[3007,-75],[3057,-70],[3107,-64],[3157,-57],[3207,-49],[3257,-39],[3307,-28],[3357,-17],[3407,2],[3458,10],[3508,28],[3558,40],[3608,53],[3658,63],[3708,73],[3758,77],[3808,82],[3858,95],[3908,119],[3959,134],[4009,171],[4059,215],[4109,265],[4159,342],[4209,357],[4259,373],[4309,385],[4359,395],[4410,396],[4460,395],[4510,395],[4560,398],[4610,397],[4660,401],[4710,406],[4760,419],[4810,421],[4861,420],[4911,419],[4961,416],[5011,405],[5061,386],[5111,363],[5161,332],[5211,288],[5261,268],[5312,235],[5362,207],[5412,151],[5462,117],[5512,93],[5562,41],[5611,21],[5661,-3],[5711,-33],[5761,-62],[5811,-90],[5861,-119],[5911,-147],[5961,-175],[6011,-202],[6061,-228],[6110,-254],[6160,-280],[6210,-305],[6260,-329],[6310,-353],[6360,-376],[6410,-398],[6460,-419],[6509,-438],[6560,-455],[6609,-469],[6659,-480],[6709,-489],[6759,-494],[6809,-495],[6859,-492],[6909,-485],[6959,-474],[7008,-458],[7059,-437],[7108,-413],[7158,-384],[7208,-350],[7258,-313],[7308,-272],[7358,-227],[7408,-178],[7458,-127],[7507,-63],[7558,25],[7607,126],[7657,207],[7707,237],[7757,291],[7807,381],[7857,478],[7907,589],[7957,668],[8006,678],[8056,683],[8106,685],[8156,688],[8206,692],[8256,699],[8306,703],[8356,706],[8406,715],[8456,719],[8505,721],[8555,724],[8605,724],[8655,721],[8705,718],[8755,715],[8805,706],[8855,692],[8905,676],[8955,660],[9004,645],[9054,633],[9104,626],[9154,620],[9204,601],[9254,577],[9304,555],[9354,535],[9403,514],[9454,488],[9503,466],[9553,443],[9603,421],[9653,401],[9703,380],[9753,358],[9803,338],[9853,321],[9902,313],[9953,320],[10002,323],[10052,320],[10102,318],[10152,316],[10202,306],[10252,289],[10302,268],[10352,249],[10401,233],[10452,222],[10501,217],[10551,217],[10601,211],[10651,207],[10701,203],[10751,198],[10801,198],[10851,196],[10900,194],[10950,195],[11000,195],[11050,196],[11100,199],[11132,200]]};
    vm.barData.series[0] = response.range_height.map(function(e){
        return e[1];
    });
    // var response = {"data":{"shape":[{"lat":27.417101,"lon":88.220596},{"lat":27.416653,"lon":88.220596},{"lat":27.416204,"lon":88.220596},{"lat":27.415756,"lon":88.220596},{"lat":27.415308,"lon":88.220596},{"lat":27.41486,"lon":88.220596},{"lat":27.414412,"lon":88.220596},{"lat":27.413961,"lon":88.220596},{"lat":27.413513,"lon":88.220596},{"lat":27.413063,"lon":88.220596},{"lat":27.412615,"lon":88.220596},{"lat":27.412165,"lon":88.220596},{"lat":27.411716,"lon":88.220596},{"lat":27.411266,"lon":88.220596},{"lat":27.410818,"lon":88.220596},{"lat":27.410368,"lon":88.220596},{"lat":27.40992,"lon":88.220596},{"lat":27.40947,"lon":88.220596},{"lat":27.409021,"lon":88.220596},{"lat":27.408571,"lon":88.220596},{"lat":27.408123,"lon":88.220596},{"lat":27.407673,"lon":88.220596},{"lat":27.407225,"lon":88.220596},{"lat":27.406775,"lon":88.220596},{"lat":27.406326,"lon":88.220596},{"lat":27.405876,"lon":88.220596},{"lat":27.405428,"lon":88.220596},{"lat":27.404978,"lon":88.220596},{"lat":27.40453,"lon":88.220596},{"lat":27.404079,"lon":88.220596},{"lat":27.403631,"lon":88.220596},{"lat":27.403181,"lon":88.220596},{"lat":27.402733,"lon":88.220596},{"lat":27.402283,"lon":88.220596},{"lat":27.401834,"lon":88.220596},{"lat":27.401384,"lon":88.220596},{"lat":27.400936,"lon":88.220596},{"lat":27.400486,"lon":88.220596},{"lat":27.400038,"lon":88.220596},{"lat":27.399588,"lon":88.220596},{"lat":27.399139,"lon":88.220596},{"lat":27.398689,"lon":88.220596},{"lat":27.398241,"lon":88.220596},{"lat":27.397791,"lon":88.220596},{"lat":27.397343,"lon":88.220596},{"lat":27.396893,"lon":88.220596},{"lat":27.396444,"lon":88.220596},{"lat":27.395994,"lon":88.220596},{"lat":27.395546,"lon":88.220596},{"lat":27.395096,"lon":88.220596},{"lat":27.394648,"lon":88.220596},{"lat":27.394197,"lon":88.220596},{"lat":27.393749,"lon":88.220596},{"lat":27.393299,"lon":88.220596},{"lat":27.392851,"lon":88.220596},{"lat":27.392401,"lon":88.220596},{"lat":27.391953,"lon":88.220596},{"lat":27.391502,"lon":88.220596},{"lat":27.391054,"lon":88.220596},{"lat":27.390604,"lon":88.220596},{"lat":27.390156,"lon":88.220596},{"lat":27.389706,"lon":88.220596},{"lat":27.389257,"lon":88.220596},{"lat":27.388807,"lon":88.220596},{"lat":27.388359,"lon":88.220596},{"lat":27.387909,"lon":88.220596},{"lat":27.387461,"lon":88.220596},{"lat":27.387011,"lon":88.220596},{"lat":27.386562,"lon":88.220596},{"lat":27.386112,"lon":88.220596},{"lat":27.385664,"lon":88.220596},{"lat":27.385214,"lon":88.220596},{"lat":27.384766,"lon":88.220596},{"lat":27.384315,"lon":88.220596},{"lat":27.383867,"lon":88.220596},{"lat":27.383417,"lon":88.220596},{"lat":27.382969,"lon":88.220596},{"lat":27.382519,"lon":88.220596},{"lat":27.382071,"lon":88.220596},{"lat":27.38162,"lon":88.220596},{"lat":27.381172,"lon":88.220596},{"lat":27.380722,"lon":88.220596},{"lat":27.380274,"lon":88.220596},{"lat":27.379824,"lon":88.220596},{"lat":27.379375,"lon":88.220596},{"lat":27.378925,"lon":88.220596},{"lat":27.378477,"lon":88.220596},{"lat":27.378027,"lon":88.220596},{"lat":27.377579,"lon":88.220596},{"lat":27.377129,"lon":88.220596},{"lat":27.37668,"lon":88.220596},{"lat":27.37623,"lon":88.220596},{"lat":27.375782,"lon":88.220596},{"lat":27.375332,"lon":88.220596},{"lat":27.374884,"lon":88.220596},{"lat":27.374434,"lon":88.220596},{"lat":27.373985,"lon":88.220596},{"lat":27.373535,"lon":88.220596},{"lat":27.373087,"lon":88.220596},{"lat":27.372637,"lon":88.220596},{"lat":27.372189,"lon":88.220596},{"lat":27.371738,"lon":88.220596},{"lat":27.37129,"lon":88.220596},{"lat":27.37084,"lon":88.220596},{"lat":27.370392,"lon":88.220596},{"lat":27.369942,"lon":88.220596},{"lat":27.369493,"lon":88.220596},{"lat":27.369043,"lon":88.220596},{"lat":27.368595,"lon":88.220596},{"lat":27.368145,"lon":88.220596},{"lat":27.367697,"lon":88.220596},{"lat":27.367247,"lon":88.220596},{"lat":27.366798,"lon":88.220596},{"lat":27.366348,"lon":88.220596},{"lat":27.3659,"lon":88.220596},{"lat":27.36545,"lon":88.220596},{"lat":27.365002,"lon":88.220596},{"lat":27.364552,"lon":88.220596},{"lat":27.364103,"lon":88.220596},{"lat":27.363653,"lon":88.220596},{"lat":27.363205,"lon":88.220596},{"lat":27.362755,"lon":88.220596},{"lat":27.362307,"lon":88.220596},{"lat":27.361856,"lon":88.220596},{"lat":27.361408,"lon":88.220596},{"lat":27.360958,"lon":88.220596},{"lat":27.36051,"lon":88.220596},{"lat":27.36006,"lon":88.220596},{"lat":27.359612,"lon":88.220596},{"lat":27.359161,"lon":88.220596},{"lat":27.358713,"lon":88.220596},{"lat":27.358263,"lon":88.220596},{"lat":27.357815,"lon":88.220596},{"lat":27.357365,"lon":88.220596},{"lat":27.356916,"lon":88.220596},{"lat":27.356466,"lon":88.220596},{"lat":27.356018,"lon":88.220596},{"lat":27.355568,"lon":88.220596},{"lat":27.35512,"lon":88.220596},{"lat":27.35467,"lon":88.220596},{"lat":27.354221,"lon":88.220596},{"lat":27.353771,"lon":88.220596},{"lat":27.353323,"lon":88.220596},{"lat":27.352873,"lon":88.220596},{"lat":27.352425,"lon":88.220596},{"lat":27.351974,"lon":88.220596},{"lat":27.351526,"lon":88.220596},{"lat":27.351076,"lon":88.220596},{"lat":27.350628,"lon":88.220596},{"lat":27.350178,"lon":88.220596},{"lat":27.34973,"lon":88.220596},{"lat":27.349279,"lon":88.220596},{"lat":27.348831,"lon":88.220596},{"lat":27.348381,"lon":88.220596},{"lat":27.347933,"lon":88.220596},{"lat":27.347483,"lon":88.220596},{"lat":27.347034,"lon":88.220596},{"lat":27.346584,"lon":88.220596},{"lat":27.346136,"lon":88.220596},{"lat":27.345686,"lon":88.220596},{"lat":27.345238,"lon":88.220596},{"lat":27.344788,"lon":88.220596},{"lat":27.344339,"lon":88.220596},{"lat":27.343889,"lon":88.220596},{"lat":27.343441,"lon":88.220596},{"lat":27.342991,"lon":88.220596},{"lat":27.342543,"lon":88.220596},{"lat":27.342093,"lon":88.220596},{"lat":27.341644,"lon":88.220596},{"lat":27.341194,"lon":88.220596},{"lat":27.340746,"lon":88.220596},{"lat":27.340296,"lon":88.220596},{"lat":27.339848,"lon":88.220596},{"lat":27.339397,"lon":88.220596},{"lat":27.338949,"lon":88.220596},{"lat":27.338499,"lon":88.220596},{"lat":27.338051,"lon":88.220596},{"lat":27.337601,"lon":88.220596},{"lat":27.337152,"lon":88.220596},{"lat":27.336702,"lon":88.220596},{"lat":27.336254,"lon":88.220596},{"lat":27.335804,"lon":88.220596},{"lat":27.335356,"lon":88.220596},{"lat":27.334906,"lon":88.220596},{"lat":27.334457,"lon":88.220596},{"lat":27.334007,"lon":88.220596},{"lat":27.333559,"lon":88.220596},{"lat":27.333109,"lon":88.220596},{"lat":27.332661,"lon":88.220596},{"lat":27.332211,"lon":88.220596},{"lat":27.331762,"lon":88.220596},{"lat":27.331312,"lon":88.220596},{"lat":27.330864,"lon":88.220596},{"lat":27.330414,"lon":88.220596},{"lat":27.329966,"lon":88.220596},{"lat":27.329515,"lon":88.220596},{"lat":27.329067,"lon":88.220596},{"lat":27.328617,"lon":88.220596},{"lat":27.328169,"lon":88.220596},{"lat":27.327719,"lon":88.220596},{"lat":27.327271,"lon":88.220596},{"lat":27.32682,"lon":88.220596},{"lat":27.326372,"lon":88.220596},{"lat":27.325922,"lon":88.220596},{"lat":27.325474,"lon":88.220596},{"lat":27.325024,"lon":88.220596},{"lat":27.324575,"lon":88.220596},{"lat":27.324125,"lon":88.220596},{"lat":27.323677,"lon":88.220596},{"lat":27.323227,"lon":88.220596},{"lat":27.322779,"lon":88.220596},{"lat":27.322329,"lon":88.220596},{"lat":27.32188,"lon":88.220596},{"lat":27.32143,"lon":88.220596},{"lat":27.320982,"lon":88.220596},{"lat":27.320532,"lon":88.220596},{"lat":27.320084,"lon":88.220596},{"lat":27.319633,"lon":88.220596},{"lat":27.319185,"lon":88.220596},{"lat":27.318735,"lon":88.220596},{"lat":27.318287,"lon":88.220596},{"lat":27.317837,"lon":88.220596},{"lat":27.317389,"lon":88.220596},{"lat":27.317101,"lon":88.220596}],"range_height":[[0,3171],[50,3149],[100,3131],[150,3099],[200,3071],[249,3036],[299,2999],[349,2961],[399,2925],[449,2899],[499,2885],[549,2858],[599,2842],[650,2840],[699,2834],[750,2819],[799,2811],[850,2794],[899,2780],[950,2756],[999,2722],[1050,2687],[1099,2635],[1150,2627],[1199,2613],[1250,2609],[1299,2607],[1350,2604],[1399,2592],[1450,2571],[1499,2543],[1550,2524],[1599,2508],[1650,2497],[1699,2477],[1750,2447],[1799,2437],[1850,2424],[1899,2409],[1950,2387],[1999,2371],[2050,2337],[2099,2309],[2150,2267],[2199,2232],[2250,2184],[2299,2127],[2350,2086],[2399,2039],[2450,1984],[2500,1947],[2550,1937],[2600,1947],[2650,1949],[2700,1916],[2750,1894],[2800,1873],[2850,1861],[2900,1894],[2950,1951],[3000,1990],[3050,2005],[3100,2016],[3150,2004],[3200,1983],[3250,1983],[3300,1989],[3350,1992],[3400,1992],[3450,1981],[3500,1950],[3550,1931],[3600,1934],[3650,1949],[3700,1945],[3750,1941],[3800,1928],[3850,1900],[3900,1865],[3950,1841],[4000,1831],[4050,1821],[4100,1807],[4150,1798],[4200,1787],[4250,1773],[4300,1764],[4350,1756],[4400,1748],[4450,1744],[4500,1741],[4550,1734],[4600,1727],[4650,1722],[4700,1718],[4750,1716],[4800,1714],[4850,1714],[4900,1719],[4950,1735],[5000,1747],[5050,1747],[5100,1745],[5150,1742],[5200,1740],[5250,1737],[5300,1732],[5350,1727],[5400,1716],[5450,1707],[5500,1706],[5550,1736],[5600,1752],[5650,1758],[5700,1755],[5750,1749],[5800,1743],[5850,1736],[5900,1733],[5950,1738],[6000,1755],[6050,1767],[6100,1754],[6150,1751],[6200,1734],[6250,1712],[6300,1680],[6350,1663],[6400,1654],[6450,1654],[6500,1661],[6550,1658],[6600,1642],[6650,1618],[6700,1588],[6750,1550],[6800,1530],[6850,1490],[6900,1462],[6950,1417],[7000,1376],[7050,1334],[7100,1276],[7150,1253],[7200,1250],[7250,1256],[7300,1250],[7350,1234],[7400,1215],[7450,1180],[7500,1144],[7550,1099],[7600,1052],[7650,1008],[7700,989],[7750,986],[7800,1016],[7850,1055],[7900,1084],[7950,1104],[8000,1133],[8050,1173],[8100,1199],[8150,1217],[8200,1253],[8250,1279],[8300,1312],[8350,1340],[8400,1366],[8450,1404],[8500,1426],[8550,1455],[8600,1476],[8650,1490],[8700,1507],[8750,1526],[8800,1512],[8850,1463],[8900,1412],[8950,1346],[9000,1299],[9050,1248],[9100,1181],[9150,1137],[9200,1111],[9250,1100],[9300,1129],[9350,1170],[9400,1205],[9450,1237],[9500,1266],[9550,1302],[9600,1322],[9650,1328],[9700,1316],[9750,1292],[9800,1272],[9850,1244],[9900,1228],[9950,1208],[10000,1194],[10050,1189],[10100,1199],[10150,1200],[10200,1198],[10250,1201],[10300,1218],[10350,1224],[10400,1220],[10450,1210],[10500,1215],[10550,1230],[10600,1232],[10650,1220],[10700,1203],[10750,1156],[10800,1122],[10850,1088],[10900,1067],[10950,1068],[11000,1074],[11050,1102],[11100,1118],[11132,1133]]},"status":200,"config":{"method":"GET","transformRequest":[null],"transformResponse":[null],"url":"https://elevation.mapzen.com/height?api_key=elevation-u7RCaXn&json={\"shape\":[{\"lat\":27.4171,\"lon\":88.2206},{\"lat\":27.3171,\"lon\":88.2206}],\"range\":true,\"resample_distance\":50}","headers":{"Accept":"application/json, text/plain, */*"}},"statusText":"OK"};
    // console.log(response.data);
    // vm.barData.series[0] = response.data.range_height.map(function(e){
    //     return e[1];
    // });
    vm.SimilarOccurrence = SimilarOccurrence;//.getSimilar({TAXONKEY: 2435146});
    vm.center = {zoom: 9, lat: 0, lng: 0};
    vm.markers = {};
    var accessToken = 'pk.eyJ1IjoiZ2JpZiIsImEiOiJjaWxhZ2oxNWQwMDBxd3FtMjhzNjRuM2lhIn0.g1IE8EfqwzKTkJ4ptv3zNQ';

    vm.tiles = {
        "name": "Outdoor",
        "url": "https://api.mapbox.com/v4/mapbox.outdoors/{z}/{x}/{y}.png?access_token=" + accessToken,
        options: {
            attribution: "&copy; <a href='https://www.mapbox.com/'>Mapbox</a> <a href='http://www.openstreetmap.org/copyright' target='_blank'>OpenStreetMap contributors</a>",
            detectRetina: false //TODO can this be fixed? Currently the mapbox retina tiles have such a small text size that I'd prefer blurry maps that I can read
        },
        type: 'xyz',
        layerOptions: {
            "showOnSelector": false,
            palette: 'yellows_reds'
        }
    };
    vm.mapDefaults = {
        zoomControlPosition: 'topleft',
        scrollWheelZoom: false
   };
   vm.mapEvents = {
        map: {
            enable: [], //https://github.com/tombatossals/angular-leaflet-directive/issues/1033
            logic: 'broadcast'
        },
        marker: {
            enable: [],
            logic: 'broadcast'
        }
    };

    vm.paths =  {

    };


    vm.tilePosStyle = {};
    vm.data;

    vm.deleteComment = function(index) {
        vm.comments.$remove(index).then(function(){});
    };

    vm.addComment = function() {
        vm.comments.$add({ comment: vm.newComment }).then(function(){
            vm.newComment = '';
        });
    };


    vm.setData = function() {
        vm.data = gb.occurrenceRecord; //TODO find a better way to parse required data to controller from server without seperate calls
        setMap(vm.data);
        getWeather(vm.data.decimalLatitude, vm.data.decimalLongitude, vm.data.eventDate);

        //https://www.firebase.com/docs/web/libraries/angular/api.html#angularfire-firebasearray
        var comments = $firebaseArray(new Firebase('https://glowing-heat-751.firebaseio.com/occurrence/' + vm.data.key));

        // make the list available in the DOM
        vm.comments = comments;

    };

    vm.parseDate = function(date) {
        return moment(date).format('MMMM DD, YYYY');
    };

    vm.weather = {};
    function getWeather(lat, lng, date) {
        if (lat && lng && date) {
            date = moment(date).unix();
            var weatherUrl = '/api/weather/' + lat + '/' + lng + '/' + date;
            $http.get(weatherUrl).then(
                function(response){
                    vm.weather = response.data;
                },
                function(){
                    //console.log("error " + error);
                    //TODO handler errors from api
                }
            );
        }
    }

    function getElevation(lat, lng) {
        var n, s, e, w, dist = 0.05;
        if (lat && lng) {
            n = lat + dist;
            s = lat - dist;
            e = lat + dist;
            w = lat - dist;
            // {%22shape%22:[{%22lat%22:47.241138,%22lon%22:9.270758},{%22lat%22:%2246.920255%22,%22lon%22:%22-45.175781%22}],%22range%22:true,%22resample_distance%22:%2241040%22}
            var query = {
                shape: [
                    {
                        lat: n, lon: lng
                    },
                    {
                        lat: s, lon: lng
                    }
                ],
                range: true, 
                resample_distance: 50
            };

            // var elevationApi = 'https://elevation.mapzen.com/height?api_key=elevation-u7RCaXn&json=' + JSON.stringify(query);
            // $http.get(elevationApi).then(
            //     function(response){
            //         vm.barData.series[0] = response.data.range_height.map(function(e){
            //             return e[1];
            //         });
            //     },
            //     function(){
            //         //console.log("error " + error);
            //         //TODO handler errors from api
            //     }
            // );
            // window.setTimeout(function(){
            //     var response = {"shape":[{"lat":59.336170,"lon":6.264790},{"lat":59.335720,"lon":6.264790},{"lat":59.335270,"lon":6.264790},{"lat":59.334820,"lon":6.264790},{"lat":59.334370,"lon":6.264790},{"lat":59.333920,"lon":6.264790},{"lat":59.333469,"lon":6.264790},{"lat":59.333019,"lon":6.264790},{"lat":59.332569,"lon":6.264790},{"lat":59.332119,"lon":6.264790},{"lat":59.331669,"lon":6.264790},{"lat":59.331219,"lon":6.264790},{"lat":59.330769,"lon":6.264790},{"lat":59.330318,"lon":6.264790},{"lat":59.329868,"lon":6.264790},{"lat":59.329418,"lon":6.264790},{"lat":59.328968,"lon":6.264790},{"lat":59.328518,"lon":6.264790},{"lat":59.328068,"lon":6.264790},{"lat":59.327618,"lon":6.264790},{"lat":59.327168,"lon":6.264790},{"lat":59.326717,"lon":6.264790},{"lat":59.326267,"lon":6.264790},{"lat":59.325817,"lon":6.264790},{"lat":59.325367,"lon":6.264790},{"lat":59.324917,"lon":6.264790},{"lat":59.324467,"lon":6.264790},{"lat":59.324017,"lon":6.264790},{"lat":59.323566,"lon":6.264790},{"lat":59.323116,"lon":6.264790},{"lat":59.322666,"lon":6.264790},{"lat":59.322216,"lon":6.264790},{"lat":59.321766,"lon":6.264790},{"lat":59.321316,"lon":6.264790},{"lat":59.320866,"lon":6.264790},{"lat":59.320415,"lon":6.264790},{"lat":59.319965,"lon":6.264790},{"lat":59.319515,"lon":6.264790},{"lat":59.319065,"lon":6.264790},{"lat":59.318615,"lon":6.264790},{"lat":59.318165,"lon":6.264790},{"lat":59.317715,"lon":6.264790},{"lat":59.317265,"lon":6.264790},{"lat":59.316814,"lon":6.264790},{"lat":59.316364,"lon":6.264790},{"lat":59.315914,"lon":6.264790},{"lat":59.315464,"lon":6.264790},{"lat":59.315014,"lon":6.264790},{"lat":59.314564,"lon":6.264790},{"lat":59.314114,"lon":6.264790},{"lat":59.313663,"lon":6.264790},{"lat":59.313213,"lon":6.264790},{"lat":59.312763,"lon":6.264790},{"lat":59.312313,"lon":6.264790},{"lat":59.311863,"lon":6.264790},{"lat":59.311413,"lon":6.264790},{"lat":59.310963,"lon":6.264790},{"lat":59.310513,"lon":6.264790},{"lat":59.310062,"lon":6.264790},{"lat":59.309612,"lon":6.264790},{"lat":59.309162,"lon":6.264790},{"lat":59.308712,"lon":6.264790},{"lat":59.308262,"lon":6.264790},{"lat":59.307812,"lon":6.264790},{"lat":59.307362,"lon":6.264790},{"lat":59.306911,"lon":6.264790},{"lat":59.306461,"lon":6.264790},{"lat":59.306011,"lon":6.264790},{"lat":59.305561,"lon":6.264790},{"lat":59.305111,"lon":6.264790},{"lat":59.304661,"lon":6.264790},{"lat":59.304211,"lon":6.264790},{"lat":59.303761,"lon":6.264790},{"lat":59.303310,"lon":6.264790},{"lat":59.302860,"lon":6.264790},{"lat":59.302410,"lon":6.264790},{"lat":59.301960,"lon":6.264790},{"lat":59.301510,"lon":6.264790},{"lat":59.301060,"lon":6.264790},{"lat":59.300610,"lon":6.264790},{"lat":59.300159,"lon":6.264790},{"lat":59.299709,"lon":6.264790},{"lat":59.299259,"lon":6.264790},{"lat":59.298809,"lon":6.264790},{"lat":59.298359,"lon":6.264790},{"lat":59.297909,"lon":6.264790},{"lat":59.297459,"lon":6.264790},{"lat":59.297009,"lon":6.264790},{"lat":59.296558,"lon":6.264790},{"lat":59.296108,"lon":6.264790},{"lat":59.295658,"lon":6.264790},{"lat":59.295208,"lon":6.264790},{"lat":59.294758,"lon":6.264790},{"lat":59.294308,"lon":6.264790},{"lat":59.293858,"lon":6.264790},{"lat":59.293407,"lon":6.264790},{"lat":59.292957,"lon":6.264790},{"lat":59.292507,"lon":6.264790},{"lat":59.292057,"lon":6.264790},{"lat":59.291607,"lon":6.264790},{"lat":59.291157,"lon":6.264790},{"lat":59.290707,"lon":6.264790},{"lat":59.290257,"lon":6.264790},{"lat":59.289806,"lon":6.264790},{"lat":59.289356,"lon":6.264790},{"lat":59.288906,"lon":6.264790},{"lat":59.288456,"lon":6.264790},{"lat":59.288006,"lon":6.264790},{"lat":59.287556,"lon":6.264790},{"lat":59.287106,"lon":6.264790},{"lat":59.286659,"lon":6.264790},{"lat":59.286209,"lon":6.264790},{"lat":59.285763,"lon":6.264790},{"lat":59.285313,"lon":6.264790},{"lat":59.284866,"lon":6.264790},{"lat":59.284416,"lon":6.264790},{"lat":59.283970,"lon":6.264790},{"lat":59.283520,"lon":6.264790},{"lat":59.283073,"lon":6.264790},{"lat":59.282623,"lon":6.264790},{"lat":59.282177,"lon":6.264790},{"lat":59.281727,"lon":6.264790},{"lat":59.281281,"lon":6.264790},{"lat":59.280830,"lon":6.264790},{"lat":59.280384,"lon":6.264790},{"lat":59.279934,"lon":6.264790},{"lat":59.279488,"lon":6.264790},{"lat":59.279037,"lon":6.264790},{"lat":59.278591,"lon":6.264790},{"lat":59.278141,"lon":6.264790},{"lat":59.277695,"lon":6.264790},{"lat":59.277245,"lon":6.264790},{"lat":59.276798,"lon":6.264790},{"lat":59.276348,"lon":6.264790},{"lat":59.275902,"lon":6.264790},{"lat":59.275452,"lon":6.264790},{"lat":59.275005,"lon":6.264790},{"lat":59.274555,"lon":6.264790},{"lat":59.274109,"lon":6.264790},{"lat":59.273659,"lon":6.264790},{"lat":59.273212,"lon":6.264790},{"lat":59.272762,"lon":6.264790},{"lat":59.272316,"lon":6.264790},{"lat":59.271866,"lon":6.264790},{"lat":59.271420,"lon":6.264790},{"lat":59.270969,"lon":6.264790},{"lat":59.270523,"lon":6.264790},{"lat":59.270073,"lon":6.264790},{"lat":59.269627,"lon":6.264790},{"lat":59.269176,"lon":6.264790},{"lat":59.268730,"lon":6.264790},{"lat":59.268280,"lon":6.264790},{"lat":59.267834,"lon":6.264790},{"lat":59.267384,"lon":6.264790},{"lat":59.266937,"lon":6.264790},{"lat":59.266487,"lon":6.264790},{"lat":59.266041,"lon":6.264790},{"lat":59.265591,"lon":6.264790},{"lat":59.265144,"lon":6.264790},{"lat":59.264694,"lon":6.264790},{"lat":59.264248,"lon":6.264790},{"lat":59.263798,"lon":6.264790},{"lat":59.263351,"lon":6.264790},{"lat":59.262901,"lon":6.264790},{"lat":59.262455,"lon":6.264790},{"lat":59.262005,"lon":6.264790},{"lat":59.261559,"lon":6.264790},{"lat":59.261108,"lon":6.264790},{"lat":59.260662,"lon":6.264790},{"lat":59.260212,"lon":6.264790},{"lat":59.259766,"lon":6.264790},{"lat":59.259315,"lon":6.264790},{"lat":59.258869,"lon":6.264790},{"lat":59.258419,"lon":6.264790},{"lat":59.257973,"lon":6.264790},{"lat":59.257523,"lon":6.264790},{"lat":59.257076,"lon":6.264790},{"lat":59.256626,"lon":6.264790},{"lat":59.256180,"lon":6.264790},{"lat":59.255730,"lon":6.264790},{"lat":59.255283,"lon":6.264790},{"lat":59.254833,"lon":6.264790},{"lat":59.254387,"lon":6.264790},{"lat":59.253937,"lon":6.264790},{"lat":59.253490,"lon":6.264790},{"lat":59.253040,"lon":6.264790},{"lat":59.252594,"lon":6.264790},{"lat":59.252144,"lon":6.264790},{"lat":59.251698,"lon":6.264790},{"lat":59.251247,"lon":6.264790},{"lat":59.250801,"lon":6.264790},{"lat":59.250351,"lon":6.264790},{"lat":59.249905,"lon":6.264790},{"lat":59.249454,"lon":6.264790},{"lat":59.249008,"lon":6.264790},{"lat":59.248558,"lon":6.264790},{"lat":59.248112,"lon":6.264790},{"lat":59.247662,"lon":6.264790},{"lat":59.247215,"lon":6.264790},{"lat":59.246765,"lon":6.264790},{"lat":59.246319,"lon":6.264790},{"lat":59.245869,"lon":6.264790},{"lat":59.245422,"lon":6.264790},{"lat":59.244972,"lon":6.264790},{"lat":59.244526,"lon":6.264790},{"lat":59.244076,"lon":6.264790},{"lat":59.243629,"lon":6.264790},{"lat":59.243179,"lon":6.264790},{"lat":59.242733,"lon":6.264790},{"lat":59.242283,"lon":6.264790},{"lat":59.241837,"lon":6.264790},{"lat":59.241386,"lon":6.264790},{"lat":59.240940,"lon":6.264790},{"lat":59.240490,"lon":6.264790},{"lat":59.240044,"lon":6.264790},{"lat":59.239594,"lon":6.264790},{"lat":59.239147,"lon":6.264790},{"lat":59.238697,"lon":6.264790},{"lat":59.238251,"lon":6.264790},{"lat":59.237801,"lon":6.264790},{"lat":59.237354,"lon":6.264790},{"lat":59.236904,"lon":6.264790},{"lat":59.236458,"lon":6.264790},{"lat":59.236172,"lon":6.264790}],"range_height":[[0,329],[50,335],[100,343],[150,354],[200,368],[251,367],[301,352],[351,339],[401,331],[451,334],[501,345],[551,329],[601,290],[651,256],[702,226],[752,204],[802,191],[852,181],[902,170],[952,170],[1002,167],[1052,159],[1102,144],[1153,121],[1203,93],[1253,65],[1303,46],[1353,30],[1403,16],[1453,19],[1503,10],[1553,-3],[1603,-14],[1654,-26],[1704,-36],[1754,-46],[1804,-55],[1854,-64],[1904,-72],[1954,-79],[2004,-85],[2054,-91],[2105,-96],[2155,-99],[2205,-102],[2255,-104],[2305,-105],[2355,-106],[2405,-106],[2455,-105],[2505,-103],[2556,-102],[2606,-100],[2656,-97],[2706,-95],[2756,-93],[2806,-90],[2856,-87],[2906,-83],[2956,-80],[3007,-75],[3057,-70],[3107,-64],[3157,-57],[3207,-49],[3257,-39],[3307,-28],[3357,-17],[3407,2],[3458,10],[3508,28],[3558,40],[3608,53],[3658,63],[3708,73],[3758,77],[3808,82],[3858,95],[3908,119],[3959,134],[4009,171],[4059,215],[4109,265],[4159,342],[4209,357],[4259,373],[4309,385],[4359,395],[4410,396],[4460,395],[4510,395],[4560,398],[4610,397],[4660,401],[4710,406],[4760,419],[4810,421],[4861,420],[4911,419],[4961,416],[5011,405],[5061,386],[5111,363],[5161,332],[5211,288],[5261,268],[5312,235],[5362,207],[5412,151],[5462,117],[5512,93],[5562,41],[5611,21],[5661,-3],[5711,-33],[5761,-62],[5811,-90],[5861,-119],[5911,-147],[5961,-175],[6011,-202],[6061,-228],[6110,-254],[6160,-280],[6210,-305],[6260,-329],[6310,-353],[6360,-376],[6410,-398],[6460,-419],[6509,-438],[6560,-455],[6609,-469],[6659,-480],[6709,-489],[6759,-494],[6809,-495],[6859,-492],[6909,-485],[6959,-474],[7008,-458],[7059,-437],[7108,-413],[7158,-384],[7208,-350],[7258,-313],[7308,-272],[7358,-227],[7408,-178],[7458,-127],[7507,-63],[7558,25],[7607,126],[7657,207],[7707,237],[7757,291],[7807,381],[7857,478],[7907,589],[7957,668],[8006,678],[8056,683],[8106,685],[8156,688],[8206,692],[8256,699],[8306,703],[8356,706],[8406,715],[8456,719],[8505,721],[8555,724],[8605,724],[8655,721],[8705,718],[8755,715],[8805,706],[8855,692],[8905,676],[8955,660],[9004,645],[9054,633],[9104,626],[9154,620],[9204,601],[9254,577],[9304,555],[9354,535],[9403,514],[9454,488],[9503,466],[9553,443],[9603,421],[9653,401],[9703,380],[9753,358],[9803,338],[9853,321],[9902,313],[9953,320],[10002,323],[10052,320],[10102,318],[10152,316],[10202,306],[10252,289],[10302,268],[10352,249],[10401,233],[10452,222],[10501,217],[10551,217],[10601,211],[10651,207],[10701,203],[10751,198],[10801,198],[10851,196],[10900,194],[10950,195],[11000,195],[11050,196],[11100,199],[11132,200]]};
            //     vm.barData.series[0] = response.range_height.map(function(e){
            //         return e[1];
            //     });
            //     debugger;
            // }, 100);
        }
    }


    function setMap(data) {
        if (typeof data.decimalLatitude === 'undefined' || typeof data.decimalLongitude === 'undefined') {
            return
        }
        getElevation(data.decimalLatitude, data.decimalLongitude);

        vm.markers.taxon = {
            //group: 'similar',
            lat: data.decimalLatitude,
            lng: data.decimalLongitude,
            focus: false
        };
        if (data.verbatimLocality) {
            vm.markers.taxon.message = '<p>'+data.verbatimLocality+'</p>';
        }
        vm.center = {
            zoom: 10,
            lat: data.decimalLatitude,
            lng: data.decimalLongitude
        };
        if (data.coordinateAccuracyInMeters > 50) {
            vm.paths.c1 = {
                weight: 2,
                color: '#ff612f',
                latlngs: {
                    lat: data.decimalLatitude,
                    lng: data.decimalLongitude
                },
                radius: data.coordinateAccuracyInMeters/2,
                type: 'circle'
            };
        }

        //set static marker
        leafletData.getMap('occurrenceMap').then(function(map) {
            //find similar records (same species, same time, same area). This gives context and can tell us whether there are possible duplicates or several people reporting the same individual
            // Useful examples as of april 2016: 195092389
            // vm.SimilarOccurrence.getSimilar(
            //     {
            //         geometry: map.getBounds(),
            //         taxonkey: data.taxonKey,
            //         eventdate: data.eventDate
            //     },
            //     data.key,
            //     function(data) {
            //         vm.similarities.similarRecords = data.results;
            //         var markers = vm.SimilarOccurrence.getMarkers(data, {
            //             key: vm.data.key,
            //             eventDate: vm.data.eventDate,
            //             decimalLatitude: vm.data.decimalLatitude,
            //             decimalLongitude: vm.data.decimalLongitude
            //         });
            //         markers.forEach(function(e, i) {
            //             vm.markers['marker_' + i] = e;
            //         });
            //     }
            // );

            var a= L.latLng(data.decimalLatitude, data.decimalLongitude);
            var projPos = map.project(a, 0);
            vm.tilePosStyle = {
                left: projPos.x/2.56 + '%',
                top: projPos.y/2.56 + '%',
                display: 'block'
            };
            map.once('focus', function() { map.scrollWheelZoom.enable(); });
        });
    }
}

module.exports = occurrenceKeyCtrl;