<div class="wrapper-horizontal-stripes occurrence-search__download">

    <section class="horizontal-stripe--paddingless white-background search-header">
        <div class="container-fluid">
            <div class="row">
                <div class="col-xs-12">
                    <nav class="article-header__category article-header__category--deep">
                        <span class="article-header__category__upper">Search occurrences</span>
                        <span class="article-header__category__lower" ng-if="occDownload.hasData()">
                            {{occDownload.state.table.count | localNumber:occDownload.state.query.locale }} results
                        </span>
                        <span class="article-header__category__lower" ng-if="!occDownload.hasData()">
                            Loading ...
                        </span>
                    </nav>
                </div>
            </div>
        </div>
    </section>

    <section class="horizontal-stripe--paddingless white-background">
        <div class="container-fluid">
            <div class="row">
                <nav class="tabs">
                    <ul>
                        <li class="tab">
                            <a href="" ui-sref="occurrenceSearchTable()">
                                Table
                            </a>
                        </li>

                        <li class="tab">
                            <a href="" ui-sref="occurrenceSearchGallery()">
                                Gallery
                            </a>
                        </li>

                        <li class="tab">
                            <a href="" ui-sref="occurrenceSearchMap()">
                                Map
                            </a>
                        </li>

                        <li class="tab tab-right isActive">
                            <span>
                                <span class="gb-icon-file-download"></span>
                                <span>
                                    Download
                                </span>
                            </span>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </section>

    <section class="horizontal-stripe--paddingless lighter-background">
        <div class="container--narrow">
            <div class="row">
                <div class="col-xs-12">
                    <div class="download-report m-t-2">
                        <div class="download-report__summary">
                            <div class="card">
                                <div class="download-report__map">
                                    <div ng-if="occDownload.loadingThumbnail">
                                        <div class="loading"></div>
                                    </div>
                                    <img ng-src="{{occDownload.thumbnail}}" gb-load="occDownload.onThumbLoad()" ng-class="{invisible:occDownload.loadingThumbnail}"/>
                                </div>
                                <div class="card__content">
                                    <dl class="inline">
                                        <div>
                                            <dt class="text-capitalize">Total</dt>
                                            <dd>
                                                <span ng-if="!occDownload.hasData()" class="loading"></span>
                                                <span ng-if="occDownload.hasData()">{{occDownload.state.table.count | localNumber:occDownload.state.query.locale }}</span>
                                            </dd>
                                        </div>
                                        <div>
                                            <dt class="text-capitalize">License</dt>
                                            <dd>
                                                <span ng-if="!occDownload.hasData()" class="loading"></span>
                                                <span ng-if="occDownload.hasData()">{{occDownload.getMostRestrictiveLicense(occDownload.state.data.facets.LICENSE.counts) | translate }}</span>
                                            </dd>
                                        </div>
                                        <div>
                                            <dt class="text-capitalize">Year range</dt>
                                            <dd>
                                                <span ng-if="!occDownload.showRange" class="loading"></span>
                                                <span ng-if="occDownload.showRange">{{occDownload.minYear}} - {{occDownload.maxYear}}</span>
                                            </dd>
                                        </div>
                                        <div>
                                            <dt class="text-capitalize">With year</dt>
                                            <dd>
                                                <span ng-if="!occDownload.showYears" class="loading"></span>
                                                <span ng-if="occDownload.showYears">{{ occDownload.withDate | formatAsPercentage }} %</span>
                                            </dd>
                                        </div>
                                        <div>
                                            <dt class="text-capitalize">with coordinates</dt>
                                            <dd>
                                                <span ng-if="!occDownload.showCoordinates" class="loading"></span>
                                                <span ng-if="occDownload.showCoordinates">{{ occDownload.hasCoordinates | formatAsPercentage }} %</span>
                                            </dd>
                                        </div>
                                        <div>
                                            <dt class="text-capitalize">with taxon match</dt>
                                            <dd>
                                                <span ng-if="!occDownload.showTaxonMatch" class="loading"></span>
                                                <span ng-if="occDownload.showTaxonMatch">{{ occDownload.withTaxonMatch | formatAsPercentage }} %</span>
                                            </dd>
                                        </div>
                                    </dl>
                                </div>
                            </div>

                            <div class="download-report__summary__download" ng-class="{invisible: !occDownload.hasData()}">
                                <div>
                                    <p>
                                        <a href="" class="gb-button--primary" ng-click="occDownload.open('SIMPLE_CSV')">
                                            <span class="gb-icon-file-download"></span> CSV
                                        </a>
                                    </p>
                                    <p class="discreet small">
                                        <span>Tab delimited csv. Only contains the data after GBIF interpretation.</span>
                                        <a href="">Learn more</a>
                                        <br/>
                                        Estimated size <strong>{{ occDownload.estKbCsv*occDownload.state.table.count*1024 |
                                        formatBytes:occDownload.state.query.locale }}</strong>
                                    </p>
                                </div>
                                <div>
                                    <p>
                                        <a href="" class="gb-button--primary" ng-click="occDownload.open('DWCA')">
                                            <span class="gb-icon-file-download"></span> Darwin Core Archive
                                        </a>
                                    </p>
                                    <p class="discreet small">
                                        <span>The Darwin Core Archive contains both the original data as publisher provided it and the GBIF interpretation.</span>
                                        <a href="">Learn more</a>
                                        <br/>
                                        Estimated size <strong>{{ occDownload.estKbDwcA*occDownload.state.table.count*1024 |
                                        formatBytes:occDownload.state.query.locale }}</strong>
                                    </p>
                                </div>
                            </div>

                        </div>
                        <div class="download-report__notifications">
                            <div ng-if="!occDownload.showTaxonMatch" class="discreet text-center">
                                <ng-include src="'/templates/components/loader/loader.html'" ng-if="!occTable.hasData() && !occTable.occurrenceState.failedRequest"></ng-include>
                                <div class="m-b-1 discreet">
                                    Hang on while we analyze your download for issues
                                </div>
                            </div>
                            <div class="m-t-2" ng-if="occDownload.showTaxonMatch">
                                <div>
                                    <h4>Known issues</h4>
                                    <div>
                                        <div xng-if="occDownload.showIssueDetails">
                                            <span class="badge-composite--{{issue.severity | lowercase }}" ng-repeat="issue in occDownload.issues | limitTo:occDownload.issueLimit">
                                                <span class="badge">{{issue.count | localNumber:occDownload.state.query.locale }}</span>
                                                <span class="badge">{{'occurrenceIssue.' + issue.title | translate}}</span>
                                            </span>
                                            <span class="badge-composite--{{issue.severity | lowercase }}" ng-repeat="issue in occDownload.issues | limitTo:100:occDownload.issueLimit" ng-if="occDownload.showAllIssues">
                                                <span class="badge">{{issue.count | localNumber:occDownload.state.query.locale }}</span>
                                                <span class="badge">{{'occurrenceIssue.' + issue.title | translate}}</span>
                                            </span>
                                        </div>
                                        <div ng-if="occDownload.issues.length > occDownload.issueLimit">
                                            <a href="" class="pull-right" ng-click="occDownload.showAllIssues = true" ng-if="!occDownload.showAllIssues">Show all</a>
                                            <a href="" class="pull-right" ng-click="occDownload.showAllIssues = false" ng-if="occDownload.showAllIssues">Show fewer</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="xcard" ng-if="occDownload.showFossilWarning()">
                                <div class="xcard__content">
                                    <h4>Fossils</h4>
                                    There are fossils among you results. That can mean species occurrences at unexpected
                                    locations. Be aware that publishers label fossil dates differently. Some use
                                    discovery date
                                    while others use estimated living period.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script type="text/ng-template" id="myModalContent.html">
        <a href="" class="gb-icon-close_L inherit pull-right m-t-05 m-r-05" type="button" ng-click="$ctrl.cancel()"></a>
        <div class="gb-modal-header">
            <span class="modal-title body-text" id="modal-title">Free of cost - not free of responsibilities</span>
        </div>
        <div class="gb-modal-body" id="modal-body">
            <p>
                The data in GBIF is the work of thousands. Proper attribution helps ensure that data like this will also be available in the future. Thank you for your understanding.
            </p>
            <input type="text" ng-model="$ctrl.username">
            {{occDownload.username}}
            <input type="password" ng-model="$ctrl.password">
            {{occDownload.password}}
            <!--<ul>-->
                <!--<li ng-repeat="item in $ctrl.issues">-->
                    <!--<a href="#" ng-click="$event.preventDefault(); $ctrl.selected.item = item">{{ item.title }}</a>-->
                <!--</li>-->
            <!--</ul>-->
            <!--Selected: <b>{{ $ctrl.selected.item.title }}</b>-->
        </div>
        <div class="gb-modal-footer">
            <a href="" class="gb-button--flat" type="button" ng-click="$ctrl.cancel()">Cancel</a>
            <a href="" class="gb-button--primary" type="button" ng-click="$ctrl.ok()">Understood</a>

        </div>
    </script>
</div>


